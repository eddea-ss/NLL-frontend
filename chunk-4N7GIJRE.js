import{d as H,f as J,g as X,h as Q,j as Z,k as q,l as ee,m as te,n as ne,o as re,p as ie,q as ae,r as oe,s as se,t as ce}from"./chunk-LCUL253L.js";import{a as S,b as T,c as y,d as x,e as f,f as E}from"./chunk-MBXY33KE.js";import{a as k,e as z,g as $,i as W,k as Y}from"./chunk-SBTY2MRA.js";import{Aa as U,B as _,Ba as P,C as u,Ca as L,Ea as N,N as a,V as C,X as o,Xa as D,Ya as B,Za as F,_a as K,a as v,b as R,cb as j,e as w,ea as m,f as b,fa as h,ga as I,ha as c,ia as l,ka as g,m as G,ma as d,na as s,v as M,w as A,wa as O,xa as V}from"./chunk-JAORLPYH.js";function pe(t,n){if(t&1){let e=g();c(0),m(1,"app-course-item",11),d("openModal",function(){let i=_(e).index,p=s(2);return u(p.openModal(i))}),h(),l()}if(t&2){let e=n.$implicit;a(),o("data",e)}}function _e(t,n){if(t&1&&(c(0),C(1,pe,2,1,"ng-container",10),l()),t&2){let e=s();a(),o("ngForOf",e.results)}}function ue(t,n){if(t&1){let e=g();c(0),m(1,"app-article-item",11),d("openModal",function(){let i=_(e).index,p=s(2);return u(p.openModal(i))}),h(),l()}if(t&2){let e=n.$implicit;a(),o("data",e)}}function me(t,n){if(t&1&&(c(0),C(1,ue,2,1,"ng-container",10),l()),t&2){let e=s();a(),o("ngForOf",e.results)}}function he(t,n){if(t&1){let e=g();c(0),m(1,"app-projects-item",11),d("openModal",function(){let i=_(e).index,p=s(2);return u(p.openModal(i))}),h(),l()}if(t&2){let e=n.$implicit;a(),o("data",e)}}function de(t,n){if(t&1&&(c(0),C(1,he,2,1,"ng-container",10),l()),t&2){let e=s();a(),o("ngForOf",e.results)}}function ge(t,n){if(t&1){let e=g();c(0),m(1,"app-financing-item",11),d("openModal",function(){let i=_(e).index,p=s(2);return u(p.openModal(i))}),h(),l()}if(t&2){let e=n.$implicit;a(),o("data",e)}}function Ce(t,n){if(t&1&&(c(0),C(1,ge,2,1,"ng-container",10),l()),t&2){let e=s();a(),o("ngForOf",e.results)}}function Se(t,n){if(t&1){let e=g();c(0),m(1,"app-supplier-item",11),d("openModal",function(){let i=_(e).index,p=s(2);return u(p.openModal(i))}),h(),l()}if(t&2){let e=n.$implicit;a(),o("data",e)}}function Te(t,n){if(t&1&&(c(0),C(1,Se,2,1,"ng-container",10),l()),t&2){let e=s();a(),o("ngForOf",e.results)}}function ye(t,n){if(t&1){let e=g();c(0),m(1,"app-startup-item",11),d("openModal",function(){let i=_(e).index,p=s(2);return u(p.openModal(i))}),h(),l()}if(t&2){let e=n.$implicit;a(),o("data",e)}}function xe(t,n){if(t&1&&(c(0),C(1,ye,2,1,"ng-container",10),l()),t&2){let e=s();a(),o("ngForOf",e.results)}}function fe(t,n){if(t&1){let e=g();c(0),m(1,"app-course-modal",12),d("close",function(){_(e);let i=s(2);return u(i.closeModal())})("next",function(){_(e);let i=s(2);return u(i.showNextItem())}),h(),l()}if(t&2){let e=s(2);a(),o("data",e.dataModal)}}function Ee(t,n){if(t&1){let e=g();c(0),m(1,"app-article-modal",12),d("close",function(){_(e);let i=s(2);return u(i.closeModal())})("next",function(){_(e);let i=s(2);return u(i.showNextItem())}),h(),l()}if(t&2){let e=s(2);a(),o("data",e.dataModal)}}function Me(t,n){if(t&1){let e=g();c(0),m(1,"app-projects-modal",12),d("close",function(){_(e);let i=s(2);return u(i.closeModal())})("next",function(){_(e);let i=s(2);return u(i.showNextItem())}),h(),l()}if(t&2){let e=s(2);a(),o("data",e.dataModal)}}function we(t,n){if(t&1){let e=g();c(0),m(1,"app-financing-modal",12),d("close",function(){_(e);let i=s(2);return u(i.closeModal())})("next",function(){_(e);let i=s(2);return u(i.showNextItem())}),h(),l()}if(t&2){let e=s(2);a(),o("data",e.dataModal)}}function Ie(t,n){if(t&1){let e=g();c(0),m(1,"app-supplier-modal",12),d("close",function(){_(e);let i=s(2);return u(i.closeModal())})("next",function(){_(e);let i=s(2);return u(i.showNextItem())}),h(),l()}if(t&2){let e=s(2);a(),o("data",e.dataModal)}}function ve(t,n){if(t&1){let e=g();c(0),m(1,"app-startup-modal",12),d("close",function(){_(e);let i=s(2);return u(i.closeModal())})("next",function(){_(e);let i=s(2);return u(i.showNextItem())}),h(),l()}if(t&2){let e=s(2);a(),o("data",e.dataModal)}}function Re(t,n){if(t&1&&(c(0),C(1,fe,2,1,"ng-container",8)(2,Ee,2,1,"ng-container",8)(3,Me,2,1,"ng-container",8)(4,we,2,1,"ng-container",8)(5,Ie,2,1,"ng-container",8)(6,ve,2,1,"ng-container",8),l()),t&2){let e=s();a(),o("ngSwitchCase",e.ResourceType.COURSE),a(),o("ngSwitchCase",e.ResourceType.ARTICLE),a(),o("ngSwitchCase",e.ResourceType.PROJECT),a(),o("ngSwitchCase",e.ResourceType.FINNANCING),a(),o("ngSwitchCase",e.ResourceType.SUPPLIER),a(),o("ngSwitchCase",e.ResourceType.STARTUP)}}var le=class t{recursosService=M(k);modeloMadurezService=M(W);modeloCaracterService=M(Y);loginService=M($);currentUser=this.loginService.currentUser;modeloMadurez=this.modeloMadurezService.modeloMadurez;modeloCaracter=this.modeloCaracterService.supplierSurvey;authState=this.loginService.authState;ResourceType=z;isModalOpen=!1;dataModal;currentData=[];currentIndex=0;tipIndex=0;charIndex=0;typingSpeed=50;tipDelay=3e3;typingTimeout;isUserTyping=!1;searchSubject=new b;searchTip="";searchMessage="";searchInput="";resultCount="";isLoading=!1;results=[];suggested=[];key={suppliers:"s\xED",curses:"2024",articles:"",projects:"",financing:"",startups:""};tips=[];customMessages=[];searchKeywords=[];breadcrumbs=[];resourceType="curses";labelType="Cursos";resourceOptions=[{type:"curses",label:"Cursos"},{type:"articles",label:"Art\xEDculos"},{type:"projects",label:"Proyectos"},{type:"financing",label:"Financiamiento"},{type:"suppliers",label:"Proveedores"},{type:"startups",label:"Startups"}];slides=[{type:"custom1",title:"Prueba el nuevo Asistente para la Industria 4.0",buttonText:"Ir al asistente",buttonLink:"https://asistente.nuevoloslagos.org"+(this.authState()==="LOGGED_IN"?"/?code="+this.currentUser()?.rut:"")},{image:"assets/images/industry.webp",content:this.authState()==="LOGGED_OUT"?"Ingresa a tu cuenta e impulsa tu empresa a la industria 4.0":"Completa tu evaluaci\xF3n y recibe un impulso para llegar a la madurez tecnol\xF3gica",buttonText:this.authState()==="LOGGED_OUT"?"Ingresa a tu cuenta":"Completa tu evaluaci\xF3n",buttonLink:this.authState()==="LOGGED_OUT"?"/login":this.currentUser()?.type==="COMPANY"?"/evaluaciones-madurez":this.currentUser()?.type==="STARTUP"?"/evaluaciones-startup":"/evaluaciones-proveedor"}];ngOnInit(){this.initializeTexts(),this.typeTip(),this.searchSubject.pipe(G(300)).subscribe(n=>{this.handleSearch(n)})}setResourceType(n){this.resourceType=n,this.initializeTexts(),this.clearSearch()}initializeTexts(){switch(this.resourceType){case"curses":this.labelType=S.LABEL,this.tips=S.TIPS,this.customMessages=S.CUSTOM_MESSAGES,this.searchKeywords=S.SEARCH_KEYWORDS,this.breadcrumbs=S.BREADCRUMBS;break;case"articles":this.labelType=T.LABEL,this.tips=T.TIPS,this.customMessages=T.CUSTOM_MESSAGES,this.searchKeywords=T.SEARCH_KEYWORDS,this.breadcrumbs=T.BREADCRUMBS;break;case"projects":this.labelType=y.LABEL,this.tips=y.TIPS,this.customMessages=y.CUSTOM_MESSAGES,this.searchKeywords=y.SEARCH_KEYWORDS,this.breadcrumbs=y.BREADCRUMBS;break;case"financing":this.labelType=f.LABEL,this.tips=f.TIPS,this.customMessages=f.CUSTOM_MESSAGES,this.searchKeywords=f.SEARCH_KEYWORDS,this.breadcrumbs=f.BREADCRUMBS;break;case"suppliers":this.labelType=x.LABEL,this.tips=x.TIPS,this.customMessages=x.CUSTOM_MESSAGES,this.searchKeywords=x.SEARCH_KEYWORDS,this.breadcrumbs=x.BREADCRUMBS;break;case"startups":this.labelType=E.LABEL,this.tips=E.TIPS,this.customMessages=E.CUSTOM_MESSAGES,this.searchKeywords=E.SEARCH_KEYWORDS,this.breadcrumbs=E.BREADCRUMBS;break}}typeTip(){if(!this.tips)return;this.tipIndex>=this.tips?.length&&(this.tipIndex=0);let n=this.tips[this.tipIndex];this.charIndex<n.length?(this.searchTip+=n.charAt(this.charIndex),this.charIndex++,this.typingTimeout=setTimeout(()=>this.typeTip(),this.typingSpeed)):this.typingTimeout=setTimeout(()=>{this.searchTip="",this.charIndex=0,this.tipIndex++,this.typeTip()},this.tipDelay)}onSearchInputChange(){this.searchSubject.next(this.searchInput.trim().toLowerCase())}handleSearch(n){n.length>=2?(this.isUserTyping||(this.isUserTyping=!0,this.showSearchMessage()),this.fetchResults(n)):(this.results=[],this.resultCount="",this.isUserTyping&&(this.isUserTyping=!1,this.hideSearchMessage(),this.searchTip="",clearTimeout(this.typingTimeout),this.typeTip()))}fetchResults(n){return w(this,null,function*(){if(n.length<2){this.results=[],this.resultCount="";return}try{this.isLoading=!0;let e=yield this.recursosService.fetchResults(n,this.resourceType);this.displayResults(e,n)}catch(e){console.warn("Error al obtener los datos:",e),this.results=[],this.resultCount="Error al obtener los datos."}finally{this.isLoading=!1,this.fetchSuggested()}})}fetchSuggested(){return w(this,null,function*(){if(this.resourceType!=="curses"&&this.resourceType!=="suppliers"||this.authState()=="LOGGED_OUT"||this.modeloCaracter()?.part1===!1&&this.modeloMadurez()?.puntaje_general===null&&this.modeloMadurez()?.puntaje_sector===null&&this.modeloMadurez()?.respuestas_formacion===null&&this.modeloMadurez()?.respuestas_proveedor===null)return;let n=this.key[this.resourceType];this.currentUser()&&this.currentUser()?.sector&&(n=this.currentUser()?.sector??this.key[this.resourceType]),this.recursosService.searchResources(n,this.resourceType,3).subscribe({next:e=>{this.suggested=e.map(r=>R(v({},r),{recomendado:!0})),console.warn(this.suggested),this.results=[...this.suggested,...this.results]},error:e=>{console.error("Error al obtener los datos:",e),console.warn("Error al obtener los datos:",e),this.suggested=[]}})})}displayResults(n,e){this.currentData=n,this.results=this.currentData,this.resultCount=`${this.currentData.length} resultado${this.currentData.length!==1?"s":""} para "${e}"`,this.currentData.length===0&&(this.resultCount="No se encontraron resultados.")}openModal(n){this.currentIndex=n;let e=this.results[this.currentIndex];this.isModalOpen=!0,this.dataModal=e}closeModal(){this.isModalOpen=!1,this.dataModal=void 0}showNextItem(){this.currentData.length!==0&&(this.currentIndex=(this.currentIndex+1)%this.currentData.length,this.openModal(this.currentIndex))}showSearchMessage(){let n=this.customMessages[Math.floor(Math.random()*this.customMessages.length)];this.searchMessage=n}hideSearchMessage(){this.searchMessage=""}addSuggestedTerm(n){let e=this.searchInput.trim(),r=e.length>0?" ":"";this.searchInput=`${e}${r}${n}`,this.onSearchInputChange()}clearSearch(){this.searchInput="",this.results=[],this.resultCount="",this.hideSearchMessage(),this.searchTip="",clearTimeout(this.typingTimeout),this.typeTip()}handleKeyPress(n,e){(n.key==="Enter"||n.key===" ")&&this.addSuggestedTerm(e)}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=A({type:t,selectors:[["app-general-search"]],standalone:!0,features:[N],decls:19,vars:19,consts:[[1,"bg-[#fff]","text-[rgb(31,41,55)]","min-h-screen"],[3,"breadcrumbs"],[1,"container","mx-auto","py-12","flex","flex-col","lg:flex-row"],[1,"w-full","lg:w-3/4","px-8"],[1,"text-3xl","font-bold","mb-6"],[3,"searchInputChange","resourceTypeChange","clearSearch","addSuggestedTerm","triggerSearch","searchTip","searchMessage","searchInput","searchKeywords","resultCount","isLoading","resourceOptions","selectedResourceType"],[1,"space-y-8"],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngIf"],[4,"ngFor","ngForOf"],[1,"p-4",3,"openModal","data"],[3,"close","next","data"]],template:function(e,r){e&1&&(m(0,"div",0),I(1,"app-breadcrumbs",1),m(2,"main",2)(3,"div",3)(4,"h1",4),O(5),h(),m(6,"app-search-controls",5),L("searchInputChange",function(p){return P(r.searchInput,p)||(r.searchInput=p),p}),d("resourceTypeChange",function(p){return r.setResourceType(p)})("searchInputChange",function(){return r.onSearchInputChange()})("clearSearch",function(){return r.clearSearch()})("addSuggestedTerm",function(p){return r.addSuggestedTerm(p)})("triggerSearch",function(){return r.onSearchInputChange()}),h(),m(7,"div",6),c(8,7),C(9,_e,2,1,"ng-container",8)(10,me,2,1,"ng-container",8)(11,de,2,1,"ng-container",8)(12,Ce,2,1,"ng-container",8)(13,Te,2,1,"ng-container",8)(14,xe,2,1,"ng-container",8),l(),h()(),m(15,"aside"),I(16,"app-sugeridos"),h()(),c(17,7),C(18,Re,7,6,"ng-container",9),l(),h()),e&2&&(a(),o("breadcrumbs",r.breadcrumbs),a(4),V(r.labelType),a(),o("searchTip",r.searchTip)("searchMessage",r.searchMessage),U("searchInput",r.searchInput),o("searchKeywords",r.searchKeywords)("resultCount",r.resultCount)("isLoading",r.isLoading)("resourceOptions",r.resourceOptions)("selectedResourceType",r.resourceType),a(2),o("ngSwitch",r.resourceType),a(),o("ngSwitchCase",r.ResourceType.COURSE),a(),o("ngSwitchCase",r.ResourceType.ARTICLE),a(),o("ngSwitchCase",r.ResourceType.PROJECT),a(),o("ngSwitchCase",r.ResourceType.FINNANCING),a(),o("ngSwitchCase",r.ResourceType.SUPPLIER),a(),o("ngSwitchCase",r.ResourceType.STARTUP),a(3),o("ngSwitch",r.resourceType),a(),o("ngIf",r.isModalOpen&&r.dataModal))},dependencies:[J,X,H,j,D,B,F,K,Z,Q,ee,q,ie,re,ne,te,oe,ae,ce,se]})};export{le as GeneralSearchComponent};
