<!-- Migas de pan para navegación -->
<app-breadcrumbs [breadcrumbs]="breadcrumbs"></app-breadcrumbs>
<div>
  <!--Login como empresa y modelo completado-->
  @if (authState()===AuthState.LoggedIn && currentUser()?.type ===
  UserType.COMPANY) {
  <section class="max-w-7xl mx-auto px-4 py-8">
    <!-- Company Header -->
    <!-- Company Header -->
    <div class="flex items-center mb-8">
      <img
        [src]="profileImageUrl"
        alt="Perfil"
        class="w-14 h-10 rounded-full mr-4"
        (error)="
          profileImageUrl =
            'https://accesos.nuevoloslagos.org/logos/default.png'
        "
      />
      <h1 class="text-4xl font-bold text-gray-700">
        <strong>Empresa:</strong>
        {{ currentUser()?.name ?? "No disponible" }}
      </h1>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <div class="lg:col-span-2">
        @if (modeloMadurez()) {
        <h2 class="text-xl font-bold text-gray-700 mb-4">
          <strong>Tipo de industria:</strong>
          {{ currentUser()?.sector }}
        </h2>
        }
        <!-- Evaluation Status Section -->
        <div class="mb-8 bg-gray-50 p-6 rounded-lg shadow-sm">
          <h2 class="text-2xl font-bold text-gray-800 mb-4">Estado de Evaluación</h2>
          
          @if (todasLasEncuestasCompletadas()) {
            <div class="bg-green-50 border-l-4 border-green-500 p-4 mb-4">
              <div class="flex">
                <div class="flex-shrink-0">
                  <svg class="h-5 w-5 text-green-400" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                  </svg>
                </div>
                <div class="ml-3">
                  <p class="text-sm leading-5 text-green-700">
                    ¡Felicitaciones! Has completado todas las evaluaciones de madurez tecnológica. Ahora puedes revisar tus resultados y recomendaciones detalladas más abajo.
                  </p>
                </div>
              </div>
            </div>
          } @else {
            <div class="space-y-4">
              <p class="text-gray-600">
                Tu evaluación del Modelo de Maduración Tecnológica para la Industria 4.0 está en proceso. Complete las encuestas pendientes para obtener una evaluación completa de la madurez tecnológica de tu empresa.
              </p>
              <div class="bg-blue-50 border-l-4 border-blue-500 p-4">
                <div class="flex">
                  <div class="flex-shrink-0">
                    <svg class="h-5 w-5 text-blue-400" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                    </svg>
                  </div>
                  <div class="ml-3">
                    <p class="text-sm leading-5 text-blue-700">
                      Seleccione las encuestas pendientes en el panel derecho para completar su evaluación.
                    </p>
                  </div>
                </div>
              </div>
            </div>
          }
        </div>
      </div>

      <!-- Take Survey Button -->
      <div class="lg:col-span-1">
        <!-- Modelo de madurez generall-->
        <button
          [disabled]="modeloMadurez()?.puntaje_general !== null"
          (click)="modeloMadurezService.openLinkGeneral()"
          class="my-1 w-full gap-2 border border-blue-700 p-8 flex text-blue-700"
          [ngClass]="{'bg-blue-50': modeloMadurez()?.puntaje_general !== null, 'bg-white': modeloMadurez()?.puntaje_general === null}"
        >
          <div class="flex flex-col">
            <strong>Modelo de Madurez General</strong>
            <span class="text-sm mt-1">
              {{ modeloMadurez()?.puntaje_general !== null ? "Completado" : "Pendiente de completar" }}
            </span>
          </div>
        </button>
        <!-- Modelo de madurez sectorial-->
        <button
          [disabled]="modeloMadurez() && modeloMadurez()?.puntaje_sector !== null"
          (click)="modeloMadurezService.openLinkSectorial()"
          class="my-1 w-full gap-2 border border-blue-700 p-8 flex text-blue-700"
          [ngClass]="{'bg-blue-50': modeloMadurez()?.puntaje_sector !== null, 'bg-white': modeloMadurez()?.puntaje_sector === null}"
        >
          <div class="flex flex-col">
            <strong>Modelo de Madurez de Sector {{ currentUser()?.sector }}</strong>
            <span class="text-sm mt-1">
              {{ modeloMadurez()?.puntaje_sector !== null ? "Completado" : "Pendiente de completar" }}
            </span>
          </div>
        </button>

        <!-- Modelo de formacion-->
        <button
          [disabled]="modeloMadurez() && modeloMadurez()?.respuestas_formacion !== null"
          (click)="modeloMadurezService.openLinkFormacion()"
          class="my-1 w-full gap-2 border border-blue-700 p-8 flex text-blue-700"
          [ngClass]="{'bg-blue-50': modeloMadurez()?.respuestas_formacion !== null, 'bg-white': modeloMadurez()?.respuestas_formacion === null}"
        >
          <div class="flex flex-col">
            <strong>Encuesta de Formación</strong>
            <span class="text-sm mt-1">
              {{ modeloMadurez()?.respuestas_formacion !== null ? "Completado" : "Pendiente de completar" }}
            </span>
          </div>
        </button>

        <!-- Modelo de proveedor-->
        <button
          [disabled]="modeloMadurez() && modeloMadurez()?.respuestas_proveedor !== null"
          (click)="modeloMadurezService.openLinkProveedores()"
          class="my-1 w-full gap-2 border border-blue-700 p-8 flex text-blue-700"
          [ngClass]="{'bg-blue-50': modeloMadurez()?.respuestas_proveedor !== null, 'bg-white': modeloMadurez()?.respuestas_proveedor === null}"
        >
          <div class="flex flex-col">
            <strong>Encuesta de Proveedores</strong>
            <span class="text-sm mt-1">
              {{ modeloMadurez()?.respuestas_proveedor !== null ? "Completado" : "Pendiente de completar" }}
            </span>
          </div>
        </button>
      </div>
    </div>

    <!-- Maturity Results Section -->
    @if (modeloMadurez()) {
    <div class="mt-8">
      <div class="bg-yellow-500 py-3 px-4 mb-8">
        <h2 class="text-2xl text-gray-600">Resultado madurez</h2>
      </div>

      <!-- New scale explanation -->
      <div class="bg-gray-100 p-4 mb-6 rounded-md">
        <p class="text-gray-700 flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-700" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
          </svg>
          <span>Escala de evaluación: <strong>1</strong> (nivel básico) a <strong>5</strong> (nivel avanzado). Los cuadros coloreados indican el nivel alcanzado en cada categoría.</span>
        </p>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Radar Chart -->
        <div class="w-full">
          <canvas #radarChartCanvas></canvas>
          <div class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
            <p class="text-gray-700 mb-3">Si deseas más recomendaciones específicas para tu empresa, visita nuestro asistente virtual:</p>
            <a [href]="'https://asistente.nuevoloslagos.org/?code=' + getRutMd5()" 
               target="_blank"
               class="inline-flex items-center px-4 py-2 bg-blue-700 text-white rounded-md hover:bg-blue-800 transition-colors">
              <span>Ir al Asistente Virtual</span>
              <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/>
              </svg>
            </a>
          </div>
        </div>


        <!-- Categories Section with improved design -->
        <div class="space-y-6">
          <!-- Capital Humano -->
          <div class="p-4 border border-gray-200 rounded-md hover:shadow-md transition-shadow">
            <h3 class="text-xl font-bold text-gray-700 mb-3">
              CAPITAL HUMANO
              <span class="inline-flex items-center ml-2">
                <ng-container *ngTemplateOutlet="gradeBoxes; context: {grade: numeroALetra(this.modeloMadurez()?.puntaje_por_categoria?.capital_humano_y_organizacion_digital)}"></ng-container>
              </span>
            </h3>
            <p class="text-gray-600 mb-2">
              {{
                capitalHumanoSections[
                  numeroANumero(
                    this.modeloMadurez()?.puntaje_por_categoria
                      ?.capital_humano_y_organizacion_digital
                  )
                ].estado
              }}
            </p>
            <p class="text-gray-600">
              <strong class="text-blue-700">Sugerencia: </strong>
              {{
                capitalHumanoSections[
                  numeroANumero(
                    this.modeloMadurez()?.puntaje_por_categoria
                      ?.capital_humano_y_organizacion_digital
                  )
                ].sugerencia
              }}
            </p>
          </div>

          <!-- Estrategia -->
          <div class="p-4 border border-gray-200 rounded-md hover:shadow-md transition-shadow">
            <h3 class="text-xl font-bold text-gray-700 mb-3">
              ESTRATEGIA
              <span class="inline-flex items-center ml-2">
                <ng-container *ngTemplateOutlet="gradeBoxes; context: {grade: numeroALetra(this.modeloMadurez()?.puntaje_por_categoria?.estrategia_y_liderazgo)}"></ng-container>
              </span>
            </h3>
            <p class="text-gray-600 mb-2">
              {{
                estrategiaSections[
                  numeroANumero(
                    this.modeloMadurez()?.puntaje_por_categoria
                      ?.estrategia_y_liderazgo
                  )
                ].estado
              }}
            </p>
            <p class="text-gray-600">
              <strong class="text-blue-700">Sugerencia: </strong>
              {{
                estrategiaSections[
                  numeroANumero(
                    this.modeloMadurez()?.puntaje_por_categoria
                      ?.estrategia_y_liderazgo
                  )
                ].sugerencia
              }}
            </p>
          </div>

          <!-- Tecnologías -->
          <div class="p-4 border border-gray-200 rounded-md hover:shadow-md transition-shadow">
            <h3 class="text-xl font-bold text-gray-700 mb-3">
              TECNOLOGÍAS
              <span class="inline-flex items-center ml-2">
                <ng-container *ngTemplateOutlet="gradeBoxes; context: {grade: numeroALetra(this.modeloMadurez()?.puntaje_por_categoria?.tecnologia_y_gestion_de_datos)}"></ng-container>
              </span>
            </h3>
            <p class="text-gray-600 mb-2">
              {{
                tecnologiaSections[
                  numeroANumero(
                    this.modeloMadurez()?.puntaje_por_categoria
                      ?.tecnologia_y_gestion_de_datos
                  )
                ].estado
              }}
            </p>
            <p class="text-gray-600">
              <strong class="text-blue-700">Sugerencia: </strong>
              {{
                tecnologiaSections[
                  numeroANumero(
                    this.modeloMadurez()?.puntaje_por_categoria
                      ?.tecnologia_y_gestion_de_datos
                  )
                ].sugerencia
              }}
            </p>
          </div>

          <!-- Gestión de Innovación -->
          <div class="p-4 border border-gray-200 rounded-md hover:shadow-md transition-shadow">
            <h3 class="text-xl font-bold text-gray-700 mb-3">
              GESTIÓN DE INNOVACIÓN
              <span class="inline-flex items-center ml-2">
                <ng-container *ngTemplateOutlet="gradeBoxes; context: {grade: numeroALetra(this.modeloMadurez()?.puntaje_por_categoria?.gestion_de_la_innovacion_y_conocimiento)}"></ng-container>
              </span>
            </h3>
            <p class="text-gray-600 mb-2">
              {{
                innovacionSections[
                  numeroANumero(
                    this.modeloMadurez()?.puntaje_por_categoria
                      ?.gestion_de_la_innovacion_y_conocimiento
                  )
                ].estado
              }}
            </p>
            <p class="text-gray-600">
              <strong class="text-blue-700">Sugerencia: </strong>
              {{
                innovacionSections[
                  numeroANumero(
                    this.modeloMadurez()?.puntaje_por_categoria
                      ?.gestion_de_la_innovacion_y_conocimiento
                  )
                ].sugerencia
              }}
            </p>
          </div>

          <!-- Automatización -->
          <div class="p-4 border border-gray-200 rounded-md hover:shadow-md transition-shadow">
            <h3 class="text-xl font-bold text-gray-700 mb-3">
              AUTOMATIZACIÓN
              <span class="inline-flex items-center ml-2">
                <ng-container *ngTemplateOutlet="gradeBoxes; context: {grade: numeroALetra(this.modeloMadurez()?.puntaje_por_categoria?.procesos_y_automatizacion)}"></ng-container>
              </span>
            </h3>
            <p class="text-gray-600 mb-2">
              {{
                automatizacionSections[
                  numeroANumero(
                    this.modeloMadurez()?.puntaje_por_categoria
                      ?.procesos_y_automatizacion
                  )
                ].estado
              }}
            </p>
            <p class="text-gray-600">
              <strong class="text-blue-700">Sugerencia: </strong>
              {{
                automatizacionSections[
                  numeroANumero(
                    this.modeloMadurez()?.puntaje_por_categoria
                      ?.procesos_y_automatizacion
                  )
                ].sugerencia
              }}
            </p>
          </div>
        </div>
      </div>
    </div>
    }
  </section>
  }
  <!--sin login-->
  @if (authState() === AuthState.LoggedOut) {
  <section class="relative overflow-hidden bg-white-50">
    <app-title-section
      [title]="'Evaluación Nivel de Madurez Tecnológica'"
      [description]="
        'Evalua el nivel de madurez tecnológica de tu empresa y conoce que acciones debes realizar para alcanzar la madurez tecnológica'
      "
      [buttonText]="'Registrate como Empresa'"
      [buttonLink]="'/registro-industria'"
      [imageSrc]="'assets/hero.webp'"
      [imageAlt]="'mockup'"
    >
    </app-title-section>
  </section>
  <section>
    <app-step-register [steps]="steps"></app-step-register>
  </section>
  }
</div>

<!-- Improved template for grade boxes -->
<ng-template #gradeBoxes let-grade="grade">
  <div class="flex items-center">
    <div class="flex items-center space-x-1">
      <span class="w-6 h-6 border border-gray-400 rounded-sm flex items-center justify-center" 
            [ngClass]="{'bg-blue-700 text-white font-bold': ['A','B','C','D','E'].includes(grade), 'bg-white': !['A','B','C','D','E'].includes(grade)}">
        <span *ngIf="grade === 'E'">1</span>
      </span>
      <span class="w-6 h-6 border border-gray-400 rounded-sm flex items-center justify-center" 
            [ngClass]="{'bg-blue-700 text-white font-bold': ['A','B','C','D'].includes(grade), 'bg-white': !['A','B','C','D'].includes(grade)}">
        <span *ngIf="grade === 'D'">2</span>
      </span>
      <span class="w-6 h-6 border border-gray-400 rounded-sm flex items-center justify-center" 
            [ngClass]="{'bg-blue-700 text-white font-bold': ['A','B','C'].includes(grade), 'bg-white': !['A','B','C'].includes(grade)}">
        <span *ngIf="grade === 'C'">3</span>
      </span>
      <span class="w-6 h-6 border border-gray-400 rounded-sm flex items-center justify-center" 
            [ngClass]="{'bg-blue-700 text-white font-bold': ['A','B'].includes(grade), 'bg-white': !['A','B'].includes(grade)}">
        <span *ngIf="grade === 'B'">4</span>
      </span>
      <span class="w-6 h-6 border border-gray-400 rounded-sm flex items-center justify-center" 
            [ngClass]="{'bg-blue-700 text-white font-bold': grade === 'A', 'bg-white': grade !== 'A'}">
        <span *ngIf="grade === 'A'">5</span>
      </span>
    </div>
  </div>
</ng-template>
